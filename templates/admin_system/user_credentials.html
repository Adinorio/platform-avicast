{% extends "admin_system/base.html" %}
{% load static %}

{% block admin_content %}
<!-- User Credentials Display -->
<div class="row mb-4">
    <div class="col-12">
        <div class="admin-card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fas fa-check-circle me-2"></i>
                    User Created Successfully
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Important:</strong> Please save these credentials securely. They will not be shown again for security reasons.
                </div>

                {% if credentials %}
                <div class="row">
                    <div class="col-md-6">
                        <div class="credentials-box">
                            <h6 class="text-muted mb-3">User Information</h6>
                            <div class="d-flex align-items-center mb-3">
                                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px; font-size: 1.2rem;">
                                    {{ user_obj.first_name.0|upper }}{{ user_obj.last_name.0|upper }}
                                </div>
                                <div>
                                    <h5 class="mb-0">{{ user_obj.get_full_name }}</h5>
                                    <small class="text-muted">{{ user_obj.role }}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="credentials-box">
                            <h6 class="text-muted mb-3">Login Credentials</h6>
                            <div class="credential-item">
                                <label class="form-label text-muted">Employee ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-control credential-input" value="{{ credentials.employee_id }}" readonly>
                                    <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('employee_id')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="credential-item mt-3">
                                <label class="form-label text-muted">Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control credential-input" value="{{ credentials.password }}" readonly id="password_field">
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword()">
                                        <i class="fas fa-eye" id="password_icon"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('password')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="alert alert-warning">
                            <h6 class="alert-heading">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Security Notice
                            </h6>
                            <ul class="mb-0">
                                <li>These credentials are shown only once for security reasons</li>
                                <li>Please provide these credentials to the user securely</li>
                                <li>The user should change their password on first login</li>
                                <li>Do not share these credentials via unsecured channels</li>
                            </ul>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Credentials are no longer available. They were displayed once for security reasons.
                </div>
                {% endif %}
                
                <div class="d-flex gap-2 mt-4">
                    <a href="{% url 'admin_system:user_detail' user_obj.id %}" class="btn btn-admin btn-primary">
                        <i class="fas fa-user me-2"></i>View User Details
                    </a>
                    <a href="{% url 'admin_system:user_management' %}" class="btn btn-admin btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to User List
                    </a>
                    <button class="btn btn-admin btn-success" onclick="printCredentials()">
                        <i class="fas fa-print me-2"></i>Print Credentials
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.credentials-box {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
    padding: 1.5rem;
    height: 100%;
}

.credential-item {
    margin-bottom: 1rem;
}

.credential-input {
    font-family: 'Courier New', monospace;
    font-weight: 600;
}

@media print {
    .btn, .alert {
        display: none !important;
    }
    
    .credentials-box {
        border: 2px solid #000 !important;
        background: white !important;
    }
}
</style>

<script>
function copyToClipboard(type) {
    let value;
    if (type === 'employee_id') {
        value = '{{ credentials.employee_id }}';
    } else if (type === 'password') {
        value = '{{ credentials.password }}';
    }
    
    navigator.clipboard.writeText(value).then(function() {
        // Show success feedback
        const button = event.target.closest('button');
        const originalIcon = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check text-success"></i>';
        
        setTimeout(function() {
            button.innerHTML = originalIcon;
        }, 2000);
    });
}

function togglePassword() {
    const passwordField = document.getElementById('password_field');
    const passwordIcon = document.getElementById('password_icon');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        passwordIcon.className = 'fas fa-eye-slash';
    } else {
        passwordField.type = 'password';
        passwordIcon.className = 'fas fa-eye';
    }
}

function printCredentials() {
    window.print();
}

// Auto-hide credentials after 5 minutes for security
setTimeout(function() {
    if (confirm('For security reasons, this page will redirect to user details. Do you want to continue?')) {
        window.location.href = '{% url "admin_system:user_detail" user_obj.id %}';
    }
}, 300000); // 5 minutes
</script>
{% endblock %}
