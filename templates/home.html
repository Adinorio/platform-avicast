{% extends 'base.html' %}

{% block title %}AVICAST System - Home{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    {% if user.is_authenticated %}
        <!-- Password Change Modal for First-Time Login -->
        {% if user.role == 'SUPERADMIN' and not user.password_changed %}
        <div class="modal fade show d-block" id="passwordChangeModal" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-key me-2"></i>Change Default Password
                        </h5>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Security Notice:</strong> You are using the default password. Please change it immediately for security reasons.
                        </div>
                        <form method="post" action="{% url 'admin_system:password_change' %}">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="new_password" class="form-label">New Password</label>
                                <input type="password" class="form-control" id="new_password" name="new_password" required minlength="8">
                                <div class="form-text">Minimum 8 characters</div>
                            </div>
                            <div class="mb-3">
                                <label for="confirm_password" class="form-label">Confirm New Password</label>
                                <input type="password" class="form-control" id="confirm_password" name="confirm_password" required minlength="8">
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">Change Password</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if user.role == 'SUPERADMIN' %}
            <!-- Superadmin Dashboard - User Management Only -->
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="text-center mb-5">
                        <div class="mb-4">
                            <i class="fas fa-user-shield text-primary" style="font-size: 4rem;"></i>
                        </div>
                        <h1 class="display-4 fw-bold text-primary mb-3">Welcome to AVICAST System</h1>
                        <p class="lead text-muted mb-4">Employee ID: {{ user.employee_id }} | Role: {{ user.get_role_display }}</p>
                    </div>

                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0">
                                <i class="fas fa-shield-alt me-2"></i>Superadmin Access
                            </h4>
                        </div>
                        <div class="card-body p-4">
                            <p class="lead mb-4">As a Superadmin, your primary responsibility is user account management. You have access to:</p>
                            <div class="row g-4">
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center p-3 bg-light rounded">
                                        <i class="fas fa-user-plus text-primary me-3 fa-2x"></i>
                                        <div>
                                            <h6 class="mb-1 fw-bold">Create Users</h6>
                                            <small class="text-muted">Add new user accounts</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center p-3 bg-light rounded">
                                        <i class="fas fa-user-edit text-success me-3 fa-2x"></i>
                                        <div>
                                            <h6 class="mb-1 fw-bold">Edit Users</h6>
                                            <small class="text-muted">Modify existing accounts</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center p-3 bg-light rounded">
                                        <i class="fas fa-user-cog text-info me-3 fa-2x"></i>
                                        <div>
                                            <h6 class="mb-1 fw-bold">Manage Roles</h6>
                                            <small class="text-muted">Assign permissions</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-4">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <a href="{% url 'admin_system:admin_dashboard' %}" class="btn btn-primary btn-lg w-100">
                                            <i class="fas fa-tachometer-alt me-2"></i>User Management Dashboard
                                        </a>
                                    </div>
                                    <div class="col-md-6">
                                        <a href="{% url 'admin_system:user_management' %}" class="btn btn-outline-primary btn-lg w-100">
                                            <i class="fas fa-users me-2"></i>Manage Users
                                        </a>
                                    </div>
                                </div>
                                <div class="row g-3 mt-2">
                                    <div class="col-md-6">
                                        <a href="{% url 'admin_system:admin_activities' %}" class="btn btn-info btn-lg w-100">
                                            <i class="fas fa-list-alt me-2"></i>System Logs
                                        </a>
                                    </div>
                                    <div class="col-md-6">
                                        <a href="{% url 'admin_system:admin_dashboard' %}" class="btn btn-outline-secondary btn-lg w-100">
                                            <i class="fas fa-cog me-2"></i>System Administration
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="alert alert-info mt-4 mb-0">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Note:</strong> For data management, please create Admin users who will handle species, sites, and census data.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <!-- Admin and Field Worker Dashboard -->
            <div class="row mb-5">
                <div class="col-12 text-center">
                    <div class="mb-4">
                        <i class="fas fa-paw text-primary" style="font-size: 4rem;"></i>
                    </div>
                    <h1 class="display-4 fw-bold text-primary mb-3">Welcome to AVICAST System</h1>
                    <p class="lead text-muted mb-4">Employee ID: {{ user.employee_id }} | Role: {{ user.get_role_display }}</p>
                </div>
            </div>

            <!-- Enhanced Feature Cards -->
            <div class="row g-4 mb-5">
                <!-- Species Management -->
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-header bg-primary text-white text-center border-0" style="height: 120px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-paw fa-3x"></i>
                            </div>
                        </div>
                        <div class="card-body p-4 text-center">
                            <h5 class="card-title text-primary fw-bold mb-3">Species Management</h5>
                            <p class="card-text text-muted mb-4">View and manage bird species data in the database</p>
                            <a href="{% url 'fauna:species_list' %}" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-eye me-2"></i>View Species
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Site Management -->
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-header bg-success text-white text-center border-0" style="height: 120px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-map-marker-alt fa-3x"></i>
                            </div>
                        </div>
                        <div class="card-body p-4 text-center">
                            <h5 class="card-title text-success fw-bold mb-3">Site Management</h5>
                            <p class="card-text text-muted mb-4">Manage observation sites and census data</p>
                            <a href="{% url 'locations:dashboard' %}" class="btn btn-success btn-lg w-100">
                                <i class="fas fa-eye me-2"></i>View Sites
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Analytics & Reports -->
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-header bg-info text-white text-center border-0" style="height: 120px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-chart-line fa-3x"></i>
                            </div>
                        </div>
                        <div class="card-body p-4 text-center">
                            <h5 class="card-title text-info fw-bold mb-3">Analytics & Reports</h5>
                            <p class="card-text text-muted mb-4">View charts, generate reports, and analyze data</p>
                            <a href="{% url 'analytics_new:dashboard' %}" class="btn btn-info btn-lg w-100">
                                <i class="fas fa-chart-line me-2"></i>View Analytics
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Image Processing (Admin Only) -->
                {% if user.role == 'ADMIN' %}
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-header bg-info text-white text-center border-0" style="height: 120px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-camera fa-3x"></i>
                            </div>
                        </div>
                        <div class="card-body p-4 text-center">
                            <h5 class="card-title text-info fw-bold mb-3">Image Processing</h5>
                            <p class="card-text text-muted mb-4">AI-powered bird species identification and processing</p>
                            <a href="{% url 'image_processing:dashboard' %}" class="btn btn-info btn-lg w-100">
                                <i class="fas fa-upload me-2"></i>Process Images
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Weather Forecasting (Admin Only) -->
                {% if user.role == 'ADMIN' %}
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-header bg-secondary text-white text-center border-0" style="height: 120px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-cloud-sun fa-3x"></i>
                            </div>
                        </div>
                        <div class="card-body p-4 text-center">
                            <h5 class="card-title text-secondary fw-bold mb-3">Weather Forecasting</h5>
                            <p class="card-text text-muted mb-4">Weather data and field work optimization</p>
                            <a href="{% url 'weather:dashboard' %}" class="btn btn-secondary btn-lg w-100">
                                <i class="fas fa-cloud me-2"></i>View Weather
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- User Management (Superadmin Only) -->
                {% if user.role == 'SUPERADMIN' %}
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-header bg-dark text-white text-center border-0" style="height: 120px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-users-cog fa-3x"></i>
                            </div>
                        </div>
                        <div class="card-body p-4 text-center">
                            <h5 class="card-title text-dark fw-bold mb-3">User Management</h5>
                            <p class="card-text text-muted mb-4">Manage all user accounts and system permissions</p>
                            <a href="{% url 'admin_system:user_management' %}" class="btn btn-dark btn-lg w-100">
                                <i class="fas fa-users me-2"></i>Manage Users
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Mobile Data Import -->
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-header bg-info text-white text-center border-0" style="height: 120px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-map-marker-alt fa-3x"></i>
                            </div>
                        </div>
                        <div class="card-body p-4 text-center">
                            <h5 class="card-title text-info fw-bold mb-3">Site Management</h5>
                            <p class="card-text text-muted mb-4">Manage observation sites and census data</p>
                            <a href="{% url 'locations:dashboard' %}" class="btn btn-info btn-lg w-100">
                                <i class="fas fa-tachometer-alt me-2"></i>View Dashboard
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Field Worker Request System -->
                {% if user.role == 'FIELD_WORKER' %}
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-header bg-orange text-white text-center border-0" style="height: 120px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-clipboard-list fa-3x"></i>
                            </div>
                        </div>
                        <div class="card-body p-4 text-center">
                            <h5 class="card-title text-orange fw-bold mb-3">Data Requests</h5>
                            <p class="card-text text-muted mb-4">Submit requests for data changes and additions</p>
                            <a href="{% url 'admin_system:admin_dashboard' %}" class="btn btn-orange btn-lg w-100">
                                <i class="fas fa-paper-plane me-2"></i>Submit Requests
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Admin Panel Access -->
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-header bg-light text-dark text-center border-0" style="height: 120px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-cogs fa-3x text-muted"></i>
                            </div>
                        </div>
                        <div class="card-body p-4 text-center">
                            <h5 class="card-title text-muted fw-bold mb-3">Admin Panel</h5>
                            <p class="card-text text-muted mb-4">Access advanced system administration features</p>
                            <a href="{% url 'admin_system:admin_dashboard' %}" class="btn btn-outline-secondary btn-lg w-100">
                                <i class="fas fa-cog me-2"></i>System Administration
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Role-Specific Information -->
            {% if user.role == 'ADMIN' %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="alert alert-success border-0">
                        <h6 class="alert-heading">
                            <i class="fas fa-star me-2"></i>Admin Access Granted
                        </h6>
                        <p class="mb-0">As an Admin, you have full access to all system features including species management, site management, image processing, weather forecasting, and data management. User management is restricted to superadmins only.</p>
                    </div>
                </div>
            </div>
            {% elif user.role == 'FIELD_WORKER' %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="alert alert-info border-0">
                        <h6 class="alert-heading">
                            <i class="fas fa-info-circle me-2"></i>Field Worker Access
                        </h6>
                        <p class="mb-0">As a Field Worker, you can view data and submit requests for changes. All modifications must be approved by an Admin.</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- System Overview Section -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light border-0">
                            <h5 class="mb-0 text-primary">
                                <i class="fas fa-info-circle me-2"></i>How to Use the System
                            </h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="row g-4">
                                <div class="col-lg-4 col-md-6">
                                    <div class="d-flex align-items-start">
                                        <div class="flex-shrink-0 me-3">
                                            <i class="fas fa-paw text-primary fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold text-primary mb-3">Species Management</h6>
                                            <ul class="text-muted mb-0">
                                                <li>View existing bird species in the database</li>
                                                <li>Access species information and details</li>
                                                <li>Reference species for census observations</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4 col-md-6">
                                    <div class="d-flex align-items-start">
                                        <div class="flex-shrink-0 me-3">
                                            <i class="fas fa-map-marker-alt text-success fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold text-success mb-3">Site Management</h6>
                                            <ul class="text-muted mb-0">
                                                <li>Create observation sites with coordinates</li>
                                                <li>Manage site status and classifications</li>
                                                <li>Organize sites by habitat type</li>
                                                <li>Add census observations to specific sites</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4 col-md-6">
                                    <div class="d-flex align-items-start">
                                        <div class="flex-shrink-0 me-3">
                                            <i class="fas fa-chart-line text-info fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold text-info mb-3">Analytics & Reports</h6>
                                            <ul class="text-muted mb-0">
                                                <li>View interactive charts and trends</li>
                                                <li>Generate comprehensive census reports</li>
                                                <li>Analyze species diversity patterns</li>
                                                <li>Export data in various formats</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                {% if user.role == 'ADMIN' %}
                                <div class="col-lg-4 col-md-6">
                                    <div class="d-flex align-items-start">
                                        <div class="flex-shrink-0 me-3">
                                            <i class="fas fa-camera text-info fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold text-info mb-3">Image Processing</h6>
                                            <ul class="text-muted mb-0">
                                                <li>Upload bird images for AI identification</li>
                                                <li>Review and approve processing results</li>
                                                <li>Manage batch processing workflows</li>
                                                <li>Override AI results when needed</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4 col-md-6">
                                    <div class="d-flex align-items-start">
                                        <div class="flex-shrink-0 me-3">
                                            <i class="fas fa-cloud-sun text-secondary fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold text-secondary mb-3">Weather & Field Work</h6>
                                            <ul class="text-muted mb-0">
                                                <li>Access weather forecasts for sites</li>
                                                <li>Optimize field work scheduling</li>
                                                <li>Receive weather alerts and warnings</li>
                                                <li>Plan activities based on conditions</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                {% if user.role == 'FIELD_WORKER' %}
                                <div class="col-lg-4 col-md-6">
                                    <div class="d-flex align-items-start">
                                        <div class="flex-shrink-0 me-3">
                                            <i class="fas fa-clipboard-list text-orange fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold text-orange mb-3">Request System</h6>
                                            <ul class="text-muted mb-0">
                                                <li>Submit requests for data changes</li>
                                                <li>Track request status and approvals</li>
                                                <li>Communicate with administrators</li>
                                                <li>View request history and notes</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% else %}
        <!-- Guest/Unauthenticated View -->
        <div class="row justify-content-center">
            <div class="col-lg-6 text-center">
                <div class="mb-5">
                    <i class="fas fa-paw text-primary" style="font-size: 5rem;"></i>
                </div>
                <h1 class="display-4 fw-bold text-primary mb-4">Welcome to AVICAST System</h1>
                <p class="lead text-muted mb-4">Biodiversity Monitoring and Management System</p>
                <p class="text-muted mb-5">Please log in to access the system and start monitoring biodiversity.</p>
                <a href="{% url 'login' %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-sign-in-alt me-2"></i>Login
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
.feature-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.feature-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

.card-header {
    border-radius: 0.375rem 0.375rem 0 0 !important;
}

.btn {
    transition: all 0.2s ease-in-out;
}

.btn:hover {
    transform: translateY(-1px);
}

.alert {
    border: none;
    border-radius: 0.5rem;
}

.bg-light {
    background-color: #f8f9fa !important;
}

.bg-orange {
    background-color: #fd7e14 !important;
}

.text-orange {
    color: #fd7e14 !important;
}

.btn-orange {
    background-color: #fd7e14 !important;
    border-color: #fd7e14 !important;
    color: white !important;
}

.btn-orange:hover {
    background-color: #e8690b !important;
    border-color: #e8690b !important;
    color: white !important;
}
</style>
{% endblock %}
