{% extends 'base.html' %}

{% block title %}Import Sites - AVICAST System{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="display-5">
                        <i class="bi bi-upload"></i> Import Sites
                    </h1>
                    <p class="lead text-muted">Import observation sites from CSV or Excel files</p>
                </div>
                <a href="{% url 'locations:site_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Sites
                </a>
            </div>

            <!-- Import Form Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-file-earmark-arrow-up"></i> File Upload
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" novalidate>
                        {% csrf_token %}
                        
                        <!-- File Selection -->
                        <div class="mb-3">
                            <label for="{{ import_form.import_file.id_for_label }}" class="form-label">
                                <strong>{{ import_form.import_file.label }} *</strong>
                            </label>
                            <input type="file" 
                                   class="form-control {% if import_form.import_file.errors %}is-invalid{% endif %}" 
                                   id="{{ import_form.import_file.id_for_label }}" 
                                   name="{{ import_form.import_file.name }}"
                                   accept="{{ import_form.import_file.field.widget.attrs.accept }}"
                                   required>
                            {% if import_form.import_file.errors %}
                                <div class="invalid-feedback">
                                    {% for error in import_form.import_file.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            {% if import_form.import_file.help_text %}
                                <div class="form-text">{{ import_form.import_file.help_text }}</div>
                            {% endif %}
                        </div>

                        <!-- File Format Selection -->
                        <div class="mb-3">
                            <label for="{{ import_form.file_format.id_for_label }}" class="form-label">
                                <strong>{{ import_form.file_format.label }}</strong>
                            </label>
                            <select class="form-select {% if import_form.file_format.errors %}is-invalid{% endif %}" 
                                    id="{{ import_form.file_format.id_for_label }}" 
                                    name="{{ import_form.file_format.name }}">
                                {% for value, label in import_form.file_format.field.choices %}
                                    <option value="{{ value }}" {% if value == import_form.file_format.value %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if import_form.file_format.errors %}
                                <div class="invalid-feedback">
                                    {% for error in import_form.file_format.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Overwrite Option -->
                        <div class="mb-3">
                            <div class="form-check">
                                <input type="checkbox" 
                                       class="form-check-input {% if import_form.overwrite_existing.errors %}is-invalid{% endif %}" 
                                       id="{{ import_form.overwrite_existing.id_for_label }}" 
                                       name="{{ import_form.overwrite_existing.name }}"
                                       {% if import_form.overwrite_existing.value %}checked{% endif %}>
                                <label class="form-check-label" for="{{ import_form.overwrite_existing.id_for_label }}">
                                    {{ import_form.overwrite_existing.label }}
                                </label>
                                {% if import_form.overwrite_existing.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in import_form.overwrite_existing.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {% if import_form.overwrite_existing.help_text %}
                                    <div class="form-text">{{ import_form.overwrite_existing.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between align-items-center pt-3">
                            <a href="{% url 'locations:site_list' %}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-upload"></i> Import Sites
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- File Format Requirements -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-info-circle"></i> File Format Requirements
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>CSV Format</h6>
                            <ul class="small">
                                <li>First row must contain headers</li>
                                <li>Required column: "Site Name"</li>
                                <li>Optional column: "Location Description"</li>
                                <li>Use comma (,) as separator</li>
                                <li>UTF-8 encoding recommended</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Excel Format</h6>
                            <ul class="small">
                                <li>First row must contain headers</li>
                                <li>Column A: Site Name (required)</li>
                                <li>Column B: Location Description (optional)</li>
                                <li>Supported formats: .xlsx, .xls</li>
                                <li>Maximum file size: 5MB</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sample Template -->
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-download"></i> Download Sample Template
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        Download a sample template to see the correct format for importing sites.
                    </p>
                    <div class="d-flex gap-2">
                        <a href="{% url 'locations:site_export' %}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-file-earmark-text"></i> Download CSV Template
                        </a>
                        <a href="{% url 'locations:site_export_excel' %}" class="btn btn-outline-success btn-sm">
                            <i class="bi bi-file-earmark-excel"></i> Download Excel Template
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 